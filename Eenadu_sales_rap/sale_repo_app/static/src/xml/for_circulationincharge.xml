<templates xml:space="preserve">
  <t t-name="sale_repo_app.circulation_incharge_dashboard_template" owl="1">

    <!-- ðŸŒ Centering Container -->
    <div class="d-flex justify-content-center align-items-start" style="min-height: 100vh; padding-top: 2rem;">

      <!-- ðŸ“¦ Dashboard Content -->
      <div style="width: 100%; max-width: 1200px; max-height: 85vh; overflow-y: auto; padding: 1rem;">

        <!-- ðŸ”˜ 8 Button Grid -->
        <div class="d-flex flex-wrap gap-3 mb-4 justify-content-center">
          <!-- 1 -->
          <div t-on-click="openStaffList"
               class="btn btn-light btn-lg border"
               style="flex: 1 1 calc(25% - 12px); min-width: 180px; min-height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;">
            <h4 style="margin:0;">Number Of Promoters</h4>
            <div><t t-esc="state.count"/></div>
          </div>

          <!-- 2 -->
          <div t-on-click="filteredAgenciesList_open"
               class="btn btn-light btn-lg border"
               style="flex: 1 1 calc(25% - 12px); min-width: 180px; min-height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;">
            <h4 style="margin:0;">Agencies Wise Customer Forms</h4>
            <div><t t-esc="state.cu_count"/></div>
          </div>

          <!-- 3 -->
          <div t-on-click="office_staff_creation"
               class="btn btn-light btn-lg border"
               style="flex: 1 1 calc(25% - 12px); min-width: 180px; min-height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;">
            <div>Create Office Staff</div>
          </div>

          <!-- 4 -->
          <div t-on-click="openStaffList_only"
               class="btn btn-light btn-lg border"
               style="flex: 1 1 calc(25% - 12px); min-width: 180px; min-height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;">
            <div>Approved Staff</div>
          </div>

          <!-- 5 -->
          <div t-on-click="user_unactive"
               class="btn btn-light btn-lg border"
               style="flex: 1 1 calc(25% - 12px); min-width: 180px; min-height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;">
            <div>Staff Waiting for Approval</div>
          </div>

          <!-- 6 -->
          <button t-on-click="excel_report"
                  class="btn btn-outline-primary"
                  style="flex: 1 1 calc(25% - 12px); min-width: 180px; min-height: 100px; display: flex; align-items: center; justify-content: center; text-align: center;">
            <i class="fa fa-file-excel-o me-2" style="font-size: 1.5rem;"></i>
            Customer Forms Filled Work Report
          </button>

          <!-- 7 -->
          <button t-on-click="attendance_excel_report"
                  class="btn btn-outline-secondary"
                  style="flex: 1 1 calc(25% - 12px); min-width: 180px; min-height: 100px; display: flex; align-items: center; justify-content: center; text-align: center;">
            <i class="fa fa-calendar me-2" style="font-size: 1.5rem;"></i>
            Attendance Report
          </button>

          <!-- 8 -->
          <button t-on-click="reg_head_cu_form"
                  class="btn btn-outline-success"
                  style="flex: 1 1 calc(25% - 12px); min-width: 180px; min-height: 100px; display: flex; align-items: center; justify-content: center; text-align: center;">
            Total Customer Forms
          </button>

          <!-- 9: Today's Active Users -->
          <button t-on-click="loadTodayActiveUsers"
                  class="btn btn-outline-info"
                  style="flex: 1 1 calc(25% - 12px); min-width: 180px; min-height: 100px; display: flex; align-items: center; justify-content: center; text-align: center;">
            <i class="fa fa-users me-2" style="font-size: 1.5rem;"></i>
            Today's Active Users
          </button>
        </div>

        <!-- ðŸ“‹ Active Users Section -->
        <div t-if="state.activeUsersView" class="mb-4">
          <div class="row mb-3 align-items-center">
            <div class="col-auto">
              <button class="btn btn-secondary" t-on-click="goBackFromActiveUsers">
                <i class="fa fa-arrow-left me-1"></i>
                Back
              </button>
            </div>
            <div class="col">
              <h4 class="mb-0">
                <i class="fa fa-users me-2 text-success"></i>
                Today's Active Users for <t t-esc="state.unit_name" />
              </h4>
            </div>
          </div>

          <t t-if="state.loading">
            <div class="text-center py-5">
              <i class="fa fa-spinner fa-spin fa-3x text-primary mb-3"></i>
              <p class="text-muted">Loading today's active users...</p>
            </div>
          </t>
          <t t-elif="state.error">
            <div class="alert alert-danger">
              <i class="fa fa-exclamation-triangle me-2"></i>
              Error: <t t-esc="state.error" />
            </div>
          </t>
          <t t-elif="state.todayActiveUsers.length === 0">
            <div class="alert alert-info">
              <i class="fa fa-info-circle me-2"></i>
              No active users today.
            </div>
          </t>
          <t t-else="">
            <div class="card shadow-sm">
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-hover mb-0">
                    <thead class="table-light">
                      <tr>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>Starting Selfie Time</th>
                        <th>First Customer Form Time</th>
                        <th>Forms Filled Count</th>
                        <th>Started Work Area</th>
                        <th>Working Agency</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <t t-foreach="state.todayActiveUsers" t-as="au" t-key="au.user.id">
                        <tr t-on-click="() => this.selectUser(au)" style="cursor: pointer;" class="table-row-hover">
                          <td><t t-esc="au.user.name || 'Unknown'" /></td>
                          <td><t t-esc="au.user.phone || 'No phone'" /></td>
                          <td><t t-esc="au.startSelfie || 'N/A'" /></td>
                          <td><t t-esc="au.firstFormTime || 'N/A'" /></td>
                          <td><strong><t t-esc="au.formCount" /></strong></td>
                          <td><t t-esc="au.startArea || 'N/A'" /></td>
                          <td><span class="badge bg-info"><t t-esc="au.agency || 'N/A'" /></span></td>
                          <td>
                            <t t-if="state.selectedUserId === au.user.id">
                              <div class="d-flex gap-2">
                                <button t-on-click="(ev) => { ev.stopPropagation(); this.today_attendance(au.user.id); }" class="btn btn-outline-primary btn-sm">
                                  <i class="fa fa-calendar me-1"></i>
                                  Attendance
                                </button>
                                <button t-on-click="(ev) => { ev.stopPropagation(); this.totalCustomerForms(); }" class="btn btn-outline-success btn-sm">
                                  <i class="fa fa-file-o me-1"></i>
                                  Forms
                                </button>
                              </div>
                            </t>
                          </td>
                        </tr>
                      </t>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </t>
        </div>

        <!-- ðŸ“‹ Staff List Section -->
        <div t-if="state.number_of_resources" class="mb-4">
          <h4 class="mb-3">
            <t t-if="state.status==='active'">Approved Staff List</t>
            <t t-if="state.status==='un_activ'">Waiting for Approval Staff List</t>
          </h4>

          <div class="mb-3" style="max-width: 300px;">
            <input type="text" class="form-control" placeholder="Search staff..." t-model="state.searchTerm" t-on-input="saveState"/>
          </div>

          <div t-if="state.loading" class="text-muted">Loading staff...</div>
          <div t-if="state.error" class="text-danger"><t t-esc="state.error"/></div>

          <div class="d-flex flex-wrap gap-3">
            <t t-foreach="filteredStaffList" t-as="staff" t-key="staff.id">
              <div class="list-group-item border shadow-sm"
                   style="cursor:pointer; flex: 0 1 auto; min-width: 250px; max-width: 100%;"
                   t-on-click="() => this.state.status === 'un_activ' ? this.loadStaffUnactive(staff.login, staff.id, staff.name) : this.loadStaffDetails(staff.login, staff.id, staff.name)">
                <strong><t t-esc="staff.name"/></strong><br/>
                <small>
                  Unit: <t t-esc="staff.unit_name"/><br/>
                  Email: <t t-esc="staff.email"/>, Phone: <t t-esc="staff.phone"/><br/>
                  Status: <t t-esc="staff.status"/>
                </small>
                <t t-if="staff.status === 'un_activ'">
                  <button t-on-click="(ev) => { ev.stopPropagation(); this.loadStaffUnactive(staff.login, staff.id, staff.name); }"
                          class="btn btn-sm btn-success mt-2"
                          style="width: 100%;">
                    Activate User
                  </button>
                </t>
              </div>
            </t>
          </div>
        </div>

        <!-- ðŸ¢ Agency List Section -->
        <div t-if="state.view_all_customer_forms" class="mb-4">
          <h4 class="mb-3">Agencies</h4>

          <div class="mb-3" style="max-width: 300px;">
            <input type="text" class="form-control" placeholder="Search agency..." t-model="state.searchAge" t-on-input="saveState"/>
          </div>

          <div t-if="state.loading" class="text-muted">Loading agencies...</div>
          <div t-if="state.error" class="text-danger"><t t-esc="state.error"/></div>

          <div class="d-flex flex-wrap gap-3">
              <t t-foreach="filteredAgenciesList" t-as="agency" t-key="agency.id">
                <div class="list-group-item border shadow-sm"
                     style="cursor:pointer; flex: 0 1 auto; min-width: 250px; max-width: 100%;"
                     t-on-click="() => this.Open_agencies_List(agency.phone, agency.id, agency.location_name)">
                  <strong>Code: <t t-esc="agency.code"/></strong><br/>
                  <small>
                    Location: <t t-esc="agency.location_name"/><br/>
                    Phone: <t t-esc="agency.phone"/><br/>
                    Unit: <t t-esc="agency.unit_name"/>
                  </small>
                </div>
              </t>
            </div>

        </div>

        <!-- ðŸ§¾ Staff Details Section: Attendance / Total Customer Forms -->
        <div t-if="!state.number_of_resources and state.status==='active' and state.attend_customer" class="mb-4">
          <h4 class="mb-3">Staff Details for <t t-esc="state.name"/></h4>
          <div class="d-flex gap-3">
            <div t-on-click="() => this.today_attendance(state.user_id)"
                 class="btn btn-light btn-lg border"
                 style="display: inline-flex; align-items: center; justify-content: center; padding: 0.5rem 1rem; flex: 1;">
              <div>Staff Attendance</div>
            </div>

            <div t-on-click="totalCustomerForms"
                 class="btn btn-light btn-lg border"
                 style="display: inline-flex; align-items: center; justify-content: center; padding: 0.5rem 1rem; flex: 1;">
              <div>Total Customer Forms</div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Custom CSS for hover effect -->
    <style>
      .table-row-hover:hover {
        background-color: rgba(0, 123, 255, 0.1);
      }
    </style>
  </t>
</templates>